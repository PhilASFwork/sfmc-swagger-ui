swagger: "2.0"
info:
  description: ""
  version: "215.180423.1" #used for a services API version tracking
  title: "Pre-Release Salesforce Marketing Cloud Transactional Messaging APIs"
#host: "www.exacttargetapis.com" #not required - owned by docs

#####
# Section info is defined by tags and tag objects
#####
tags:
- name: "transactional sends"
- name: "transactional defintions"

schemes:
- "https"
paths:
  /transactionalmessages/v1/email/definition/{definition_key}/send:
    parameters:
      - in: path
        name: tsd_external_key
        description: "your transactional send defintion"
        required: true  #always needed because it's a path paramater
        type: string
    post:
      operationId: transactionalEmailDefinitionSend
      tags: #tags are used to group operations in Swagger UI.
      - "transactional sends"
      summary: "send a transactional email message"
      description: ""
      consumes: #this is the content-type header for the reponse
      - "application/json"
      produces: #this is the content-type header in the request
      - "application/json"
      parameters:
      - in: body
        name: "Send body"
        schema:
          allOf:
          - $ref: '#/definitions/emailRequest'
         # - $ref: '#/definitions/globalSettings'
      responses:
        200:
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/apiResponseBody'
            - $ref: '#/definitions/messageSendResponse'
  /transactionalmessages/v1/sms/definition/{definition_key}/send:
    parameters:
      - in: path
        name: tsd_external_key
        description: "your transactional send defintion"
        required: true  #always needed because it's a path paramater
        type: string
    post:
      operationId: transactionalSmsDefinitionSend
      tags: #tags are used to group operations in Swagger UI.
      - "transactional sends"
      summary: "send a transactional SMS message"
      description: ""
      consumes: #this is the content-type header for the reponse
      - "application/json"
      produces: #this is the content-type header in the request
      - "application/json"
      parameters:
      - in: body
        name: "Send body"
        schema:
          allOf:
          - $ref: '#/definitions/smsRequest'
        #  - $ref: '#/definitions/globalSettings'
      responses:
        200:
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/apiResponseBody'
            - $ref: '#/definitions/messageSendResponse'
  /transactionalmessages/v1/email/messagekey/{message_key}/status:
    parameters:
      - in: path
        name: message_key
        description: "Unique message key to check status"
        required: true  #always needed because it's a path paramater
        type: string
    get:
      tags:
      - "transactional sends"
      summary: "fetches email send status by messageKey (cached)"
      responses:
        200:
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/apiResponseBody'
            - $ref: '#/definitions/messageWebhookResponse'

definitions:
#-- Global Definitions ----------
#--------------------------------
  #globalRequestMessage: skipped due to a nest/shared inheritance model for EmailTo>MessageTo+GlobalTo>GlobalMessage w/o namespace conflicts
  globalRequestTo:
    type: object
    properties:
      messageKey:
        type: string    
        description: Unique client-provided identifier for a specific message to a recipient that could be used to provide feedback for that specific message.
        example: '9691010a-1e59-48a0-b0d8-67d9a86dc470'
      subscriberKey:
        type: "integer"
        format: "int64"
        description: a text field that contains a value that uniquely identifies a subscriber in your system. A subscriber key is limited to English characters only.
        example: robert.smith@example.com
  globalRequestFrom:
    type: object
    properties:
      name:
        type: string
        description: 'This is the name displayed when message is received (email only?)'
        example: 'NTO Notifications'    
  globalRequestAttributes:
    type: object
    description: Key:Value object for subscriber attributes defined for the message
    example: "FirstName:Robert or XMLData:<xml>example</xml>"
  #globalSettings:
  #  type: object
  #  properties:
  #    Tags: 
  #      type: array
  #      description: "Meta data for reporting and tracking"
  #      items:
  #        type: string
  #        example: "tag1, tag2"
  #    ValidityPeriod:
  #      type: integer
  #      format: int32
  #      description: "Number of seconds, after this time if the message hasn't not been processed for whatever reason (system issue, blackout window) then no message will be sent."
      #DeliveryTime:
      #  type: string
      #  format: date-time
#-- Email Definitions ---
#-------------------------
  emailRequestFrom:
    type: object
    properties:
      emailAddress: #email
        type: string
        description: 'For email channel, this would be the from address displayed when email is received. '
        example: 'notifications@nto.com'  
  emailRequestMessage:
    type: object
    properties:
      subject:
        type: string
        description: "Subject field for email. OTT Message Name (optional)"
        example: "Your 2-factor passcode"
      characterSet:
        type: string
        enum:
          - UTF-8
          - US-ASCII
          - ISO-8859-1
        description: "Character set used for message encoding.  Default is UTF-8"
        example: UTF-8
      htmlBody:
        type: string
        description: 'For email only, can be used along with Text for Multipart MIME messages'
        example: 
  emailRequestTo:
    type: "object"
    required:
      - EmailAddress
    properties:
      emailAddress:
        type: string
        description: "Recipient's email address"
        example: "robert.smith@example.com"
      #Message: //215 - waiting for Tod to validate this use case
      #  allOf:
      #   - $ref: '#/definitions/emailRequestMessage'
      attributes:
        $ref: '#/definitions/globalRequestAttributes'
      cc:
        type: array
        items:
          type: string
          example: cc_example@example.com, cc2_example@example.com
          #$ref: '#/definitions/GenericEmailArrayObject'
      bcc:
        type: array
        items:
          type: string
          example: cc_example@example.com, cc2_example@example.com
  emailRequest:
    title: email message Request
    type: object
    properties:
      from:
        allOf: 
         - $ref: '#/definitions/globalRequestFrom'
         - $ref: '#/definitions/emailRequestFrom'
      message:
        allOf:
        - $ref: '#/definitions/emailRequestMessage'
      attributes:
        allOf:
        - $ref: '#/definitions/globalRequestAttributes'
      to:
        type: array
        items:
          allOf: 
            - $ref: '#/definitions/globalRequestTo'
            - $ref: '#/definitions/emailRequestTo'
      options:
        $ref: '#/definitions/globalRequestOptions'

#-- SMS Definitions ---
#-------------------------
  smsRequestFrom:
    type: object
    properties:
      senderID:  #sms
        type: string
        description: 'SMS identifier for who sent the message. OTT presence identifier (LINE Channel ID, Facebook Messenger Page ID, Apple Business Chat Business ID)'
        example: "MySenderID"
  smsRequestMessage:
    type: object
    properties:
      text:
        type: string
        description: "SMS text message"
        example: "Your 2-factor passcode is 3484028"
      #Encoding:
      #  type: string
      #  description: TBD
      #  example: #
      #CharacterSet:
      #  type: string
      #  description: "Example UTF-8, ANSII"
      #  enum: ["UTF-8", "ASCII"]
      #ContentUrl:
      #  type: string
      #  description: 'MMS Location of the media to send'
      #  example: #
  smsRequestTo:
    type: "object"
    required:
      - MobileNumber
    properties:    
      mobileNumber:
        type: "integer"
        format: "int32"
        description: "Recipient's mobile number"
        example: #
      #Message:
      #  $ref: '#/definitions/smsRequestMessage'
      attributes:
        $ref: '#/definitions/globalRequestAttributes'
  smsRequestOptions:
    type: object
    properties:
      subscribe:
        type: boolean
        description: TBD
        example: false
      resubscribe:
        type: boolean
        description: TBD
        example: false
      keyword:
        type: array
        description: TBD
        items:
          type: string
  smsRequest:
    title: SMS message Request
    type: object
    properties:
      from:
        allOf: 
         - $ref: '#/definitions/globalRequestFrom'
         - $ref: '#/definitions/smsRequestFrom'
      message:
        allOf:
      #  - $ref: '#/definitions/globalRequestMessage'
        - $ref: '#/definitions/smsRequestMessage'
      to:
        type: array
        items:
          allOf: 
            - $ref: '#/definitions/globalRequestTo'
            - $ref: '#/definitions/smsRequestTo'
      options:
        allOf:
          - $ref: '#/definitions/globalRequestOptions'
          - $ref: '#/definitions/smsRequestOptions'

#------------------------------
  globalRequestOptions:
    type: object
    properties:
  #    Blackhole:
  #      type: boolean
  #      description: TBD
  #      example: false
  #    IngoreRecipientStatus:
  #      type: boolean
  #      description: TBD
  #      example: false
      trackingEnabled:
        type: boolean
        description: "Email: enables link tracking.  SMS: enable link tracking and shortening"
        example: false
#---------------------------------
  apiResponseBody:
    type: object
    properties:
      requestId:
        type: string
        format: UUID v4
        example: "ba9633fa-5c8d-4c42-8efa-a16412ac0c53"
      statusCode:
        type: integer
        example: 7005
      statusMessage:
        type: string
        example: "Ensure you include all required fields in the body of the request"
  messageSendResponse:
    type: object
    properties:
      responses:
        type: array
        items: 
          type: object
          properties:
            messageKey:
              type: string
              example: "9691010a-1e59-48a0-b0d8-67d9a86dc470"
            errorCode:
              type: integer
            errorMessage:
              type: string
  messageWebhookResponse:
    type: object
    properties:
      type: 
        type: string
        example: "TransactionalSendEvents.EmailSent"
      timestamp:
        type: string
        format: date-time
      compositeId:
        type: string
        example: "tsid.job.list.batch.sub"
      info:
        type: object
        properties:
          messageKey:
            type: string
            format: UUID v4
            example: "9691010a-1e59-48a0-b0d8-67d9a86dc470"
          subscriberKey: 
            type: string
          emailAddress:
            type: string
            example: "john.smith@example.com"
